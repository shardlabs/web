---
import '../styles/reset.css';
import Footer from '../components/Footer.astro';

interface Props {
    title: string;
    description: string;
    image?: string;
    author?: string;
    publishDate?: Date;
    tags?: string[];
}

const { title, description, image, author, publishDate, tags } = Astro.props;

const siteUrl = 'https://shard.sh';
const canonicalURL = new URL(Astro.url.pathname, siteUrl);
const ogImageUrl = image ? new URL(image, siteUrl).href : `${siteUrl}/icon.svg`;

// Generate schema.org structured data for SEO
const schemaData = {
    '@context': 'https://schema.org',
    '@type': 'BlogPosting',
    headline: title,
    description: description,
    image: ogImageUrl,
    author: {
        '@type': 'Organization',
        name: author || 'Shard Team',
    },
    publisher: {
        '@type': 'Organization',
        name: 'Shard',
        logo: {
            '@type': 'ImageObject',
            url: `${siteUrl}/icon.svg`,
        },
    },
    datePublished: publishDate?.toISOString(),
    mainEntityOfPage: {
        '@type': 'WebPage',
        '@id': canonicalURL.href,
    },
};
---

<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link
            rel="preconnect"
            href="https://fonts.gstatic.com"
            crossorigin="anonymous"
        />
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap"
        />
        <link rel="icon" href="/icon.svg" type="image/x-icon" />
        <link rel="canonical" href={canonicalURL} />

        <!-- SEO Meta Tags -->
        <title>{title} | Shard Blog</title>
        <meta name="description" content={description} />
        <meta name="author" content={author || 'Shard Team'} />
        {
            tags && tags.length > 0 && (
                <meta name="keywords" content={tags.join(', ')} />
            )
        }
        <meta name="generator" content={Astro.generator} />

        <!-- Open Graph / Facebook -->
        <meta property="og:type" content="article" />
        <meta property="og:url" content={canonicalURL} />
        <meta property="og:title" content={title} />
        <meta property="og:description" content={description} />
        <meta property="og:image" content={ogImageUrl} />
        <meta property="og:site_name" content="Shard" />
        {
            publishDate && (
                <meta
                    property="article:published_time"
                    content={publishDate.toISOString()}
                />
            )
        }
        {author && <meta property="article:author" content={author} />}
        {
            tags &&
                tags.map((tag) => <meta property="article:tag" content={tag} />)
        }

        <!-- Twitter -->
        <meta property="twitter:card" content="summary_large_image" />
        <meta property="twitter:url" content={canonicalURL} />
        <meta property="twitter:title" content={title} />
        <meta property="twitter:description" content={description} />
        <meta property="twitter:image" content={ogImageUrl} />

        <!-- Structured Data -->
        <script
            type="application/ld+json"
            set:html={JSON.stringify(schemaData)}
        />

        <!-- Analytics -->
        <script
            defer
            data-website-id="dfid_Y8Ni6eBgNDS55m1LIsWER"
            data-domain="shard.sh"
            src="/js/script.js"></script>
    </head>
    <body>
        <div class="blog-layout">
            <header class="blog-header">
                <nav class="blog-nav">
                    <a href="/" class="logo-link">
                        <img src="/icon.svg" alt="Shard Logo" class="logo" />
                        <span>Shard</span>
                    </a>
                    <div class="nav-links">
                        <a href="/blog">Blog</a>
                        <a href="/docs">Docs</a>
                        <a href="https://app.shard.sh">App</a>
                    </div>
                </nav>
            </header>

            <main class="blog-main">
                <slot />
            </main>

            <Footer />
        </div>
    </body>
</html>

<style is:global>
    body {
        background: #050005;
        color: #ffffff;
        position: relative;
        font-family: 'Inter', sans-serif;
        margin: 0;
        padding: 0;
    }

    /* Background blur effect similar to landing page */
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('/hero_gradient.webp') right -400px no-repeat;
        animation: fadeInBackground 3s ease-in;
        z-index: 0;
        pointer-events: none;
        opacity: 0.3;
    }

    @keyframes fadeInBackground {
        from {
            opacity: 0;
        }
        to {
            opacity: 0.3;
        }
    }

    button,
    input,
    select,
    textarea {
        font-family: 'Inter', sans-serif;
    }

    /* Blog-specific global styles */
    .blog-layout {
        position: relative;
        z-index: 1;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
    }

    .blog-header {
        padding: 20px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(5, 0, 5, 0.8);
        backdrop-filter: blur(10px);
        position: sticky;
        top: 0;
        z-index: 100;
    }

    .blog-nav {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 40px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .logo-link {
        display: flex;
        align-items: center;
        gap: 10px;
        text-decoration: none;
        color: #fff;
        font-weight: 600;
        font-size: 1.2rem;
        transition: opacity 0.2s ease;
    }

    .logo-link:hover {
        opacity: 0.8;
    }

    .logo {
        height: 28px;
        width: 28px;
    }

    .nav-links {
        display: flex;
        gap: 24px;
        align-items: center;
    }

    .nav-links a {
        color: rgba(255, 255, 255, 0.8);
        text-decoration: none;
        font-weight: 500;
        font-size: 0.95rem;
        transition: color 0.2s ease;
    }

    .nav-links a:hover {
        color: #6fcaff;
    }

    .blog-main {
        flex: 1;
        max-width: 1200px;
        margin: 0 auto;
        padding: 60px 40px;
        width: 100%;
        box-sizing: border-box;
    }

    @media (max-width: 768px) {
        .blog-nav {
            padding: 0 20px;
        }

        .nav-links {
            gap: 16px;
        }

        .nav-links a {
            font-size: 0.875rem;
        }

        .blog-main {
            padding: 40px 20px;
        }
    }
</style>
